var http = require('http');
var fs = require('fs');
var url = require("url");
var querystring = require('querystring');
var router = require('router')
var pages = require('pages')

exports.start = function(port)
{
    fs.readFile('./index.html', function (err, html) {
        if (err)
        {
            return console.log('Error: Critical failure');
        }
        var server = http.createServer(function(request, response) {
            response.writeHead(200, {"Content-Type": "text/html"});
            var page = url.parse(request.url).pathname;
            router.route({'/test':'index', '/test':'image'}, response, page);
            var params = querystring.parse(url.parse(request.url).query);

            if (params)
            {
                var result = String(html).replace("Traveller", params['name']);
                response.write(result);
            }
            else
            {
                response.write(html);
            }

            response.end();
        }).listen(port);
        console.log('Server started on port : ' + port);
    });
}
